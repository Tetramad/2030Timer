# Description

2년에 가까운 시간 동안 코딩하지 않아서 코딩하는 기억을 되살리기 위해 시작한 프로젝트이다. UN에서 낸 보고서 중 2030년대에 지구 평균 기온이 1.5도 이상으로 높아질 것이라는 예측에서 착안했다. 원본 보고서를 찾지 못 했지만 [이 페이지](https://www.un.org/sustainabledevelopment/climate-change/)에서도 언급한다. 2030년 1월 1일 00시 00분까지 남은 시간초를 표시해주는 시계로 AVR코어를 사용하는 ATmega계열 마이크로컨트롤러로 인터럽트, TWI(I2C)를 이용한 통신, 입출력 제어를 연습하는 것이 목표이다.

# Block Diagram

![Block Diagram](/doc/Block%20Diagram.webp)

# Perfboard

![Perfboard](/doc/Perfboard.jpg)

# Implementation

- [X] Displaying seconds until 2030 to FND
- [X] Changing current time using buttons
- [X] Read and write current time using RTC

# Recaps

## 버튼 디바운서 구현
### 초기 구상
소프트웨어로 구현하려면 마이크로컨트롤러의 타이머를 하나 사용하여 시간을 재야 한다. 버튼 입력만을 위해 타이머로 업타임을 계속 기록하는 것이 비효율적이라고 생각하여 하드웨어 측면에서 구현하려 했다.
### 조사
디바운서 회로를 보면 RC 저역 통과 필터와 슈미트 트리거로 구성하고 있다. 집에 슈미트 트리거가 없어서 그냥 RC 저역 통과 필터만 구성했고 그렇게 사용하는 사진도 많이 있어서 충분할 것이라 생각했다.
### 문제 발생 및 분석
회로 구성 후 여전히 바운싱 현상이 있어서 다시 생각해봤다. 입력 전압 근처에서 저주파 진동이 발생하는 경우가 충분히 있을 수 있고 이 경우 여전히 바운싱 현상이 일어난다. 이를 보완하기 위해 슈미트 트리거가 있었던 것이다.
### 해결 방안 구상
소프트웨어로 구현하는 것이 부품을 주문하여 받는 것보다 빠를 것이라고 판단하여 타이머를 이용하여 구현하기로 했다. 구현하는 중에 버튼 입력만 고려하면 굳이 업타임을 계속 기록하지 않아도 된다는 것을 깨닫고 입력 받고 일정 시간의 타이머가 끝나기 전까지 입력을 무시하는 방법으로 구현했다.

## 버튼 인터럽트
### 초기 구상
예전에 다이오드로 OR 게이트를 구성하여 여러 버튼을 하나의 인터럽트로 받는 방법을 사용한 기억이 있어서 그 방법 그대로 했다.
### 우연히 본 기능
마이크로컨트롤러 명세서를 볼 때 IO 부분을 보면서 Pin Change Interrupt 부분을 보긴 했지만 내용을 자세히 보진 않았었다. 자투리 시간에 어쩌다 그 부분을 읽게 됬는데 하드웨어로 구현했던 것이 이미 마이크로컨트롤러에서 지원하는 기능임을 알았다.
### 변경
다이오드로 연결된 버튼을 다 분리하고 PCINT 인터럽트를 사용하는 로직으로 변경했다.

## breadboard를 perfboard로 이식
### 이유
버튼이나 크리스탈 등이 브래드보드에 잘 맞지 않고 흔들리기도 하고 브래드보드는 다른 프로젝트할 때 또 써야하기 때문에 회로를 옮기기로 했다. 이미 브래드보드에 회로를 전부 구현해두었기 때문에 그대로 perfboard로 옮기면 된다고 생각하여 PCB를 설계하고 주문하는 것보다 쉽고 빠를 것이라 예상했다.
### 잘못
이 프로젝트는 9개의 7세그먼트를 사용한다. 7세그먼트들의 핀아웃만 81개에 달한다. 이를 다시 저항과 시프트 레지스터에 순차적으로 연결하려면 많은 선과 납땜이 필요하다. 3-4일이면 옮길 것이라는 예상과 다르게 배선용 선 부족까지 겹치면서 1주일 넘게 걸렸다. 이 시간이면 PCB를 설계해서 받을 수도 있었던 시간이라 생각한다.

## TWI 구현
## `time.h` 헤더와 RTC의 BCD 데이터
